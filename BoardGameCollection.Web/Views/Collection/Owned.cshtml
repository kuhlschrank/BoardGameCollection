@using System.Globalization
@using System.Linq;
@model BoardGameCollection.Web.Models.OwnedGamesList

@{
    var owners = string.Join(" und ", Model.Owners);
    ViewBag.Title = "Spiele: " + owners;
}

<h2>Spiele von @owners</h2>

<table>
    @foreach (var yearGroup in Model.GroupBy(p => new { Year = p.BoardGame.YearPublished }).OrderByDescending(group => group.Key.Year))
    {
        <tr>
            <th colspan="3" style="border-bottom: dashed 1px; text-align: center">
                <span>@yearGroup.Key.Year</span>
            </th>
        </tr>
        <tr>
            <th></th>
            <th>
                <small>Titel</small>
            </th>
            <th>
                <small>Spieler</small>
            </th>
        </tr>
        foreach (var ownedGame in yearGroup.OrderByDescending(p => p.BoardGame.AverageRating))
        {
            <tr>
                @{ var rowspan = ownedGame.Expansions.Count + 1; }
                <td rowspan="@rowspan" style="vertical-align:top">
                    <a href="@ownedGame.BoardGame.ImageUri" target="_blank">
                        <img src="@ownedGame.BoardGame.ThumbnailUri" style="height:50px;max-width:100px" />
                    </a>
                </td>
                <td>
                    <table width="100%">
                        <tr>
                            <td>
                                <a target="_blank" href="http://boardgamegeek.com/boardgame/@ownedGame.BoardGame.Id" style="text-decoration: none">@Html.DisplayFor(modelItem => ownedGame.BoardGame.Title)</a> (@string.Format(CultureInfo.InvariantCulture, "{0:0.00}", ownedGame.BoardGame.AverageRating))
                            </td>
                            <td style="text-align: right">
                                @foreach (var owner in ownedGame.Owners)
                                {
                                    <a target="_blank" href="http://www.boardgamegeek.com/collection/user/@owner" style="text-decoration: none"><small>@owner</small></a><br />
                                }
                            </td>
                        </tr>
                    </table>
                </td>
                <td>
                    @ownedGame.BoardGame.MinPlayers&nbsp;-&nbsp;@ownedGame.BoardGame.MaxPlayers&nbsp;(@ownedGame.BoardGame.BestPlayerNumber)
                </td>
            </tr>
                    foreach (var ownedExpansion in ownedGame.Expansions)
                    {
                        <tr>
                            <td>
                                <small><a target="_blank" href="http://boardgamegeek.com/boardgame/@ownedExpansion.BoardGame.Id" style="text-decoration: none">@ownedExpansion.BoardGame.Title</a> (@string.Format(CultureInfo.InvariantCulture, "{0:0.00}", ownedExpansion.BoardGame.AverageRating))</small>
                            </td>
                            <td>
                                <small>@ownedExpansion.BoardGame.MinPlayers&nbsp;-&nbsp;@ownedExpansion.BoardGame.MaxPlayers</small>
                            </td>
                        </tr>
                            }
                        }
                    }

</table>
