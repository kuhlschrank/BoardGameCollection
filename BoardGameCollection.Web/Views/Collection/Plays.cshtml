@using System.Globalization
@using System.Linq;
@using BoardGameCollection.Web.Views

@model List<BoardGameCollection.Core.Models.BoardGamePlay>

@{
    ViewBag.Title = "Gespielt";
}

<h2>Gespielt</h2>

<table class="game-table">
    @foreach (var dayGroup in Model.GroupBy(p => p.Play.Date.Date).OrderByDescending(group => group.Key))
    {
        var groupName = dayGroup.Key.ToString("D");
        <partial name="_GameTableGroupHeader" model="@groupName" />
        @foreach (var boardGamePlay in dayGroup.OrderByDescending(p => p.Play.Date))
        {
            <tr>
                <td style="vertical-align:top">
                    <a href="@boardGamePlay.BoardGame.ImageUri" target="_blank">
                        <img src="@boardGamePlay.BoardGame.ThumbnailUri" />
                    </a>
                </td>
                <td>
                    <table width="100%">
                        <tr>
                            <td>
                                <a target="_blank" href="http://boardgamegeek.com/boardgame/@boardGamePlay.BoardGame.Id" style="text-decoration: none">@Html.DisplayFor(modelItem => boardGamePlay.BoardGame.Title)</a> (@string.Format(CultureInfo.InvariantCulture, "{0:0.00}", boardGamePlay.BoardGame.AverageRating))
                            </td>
                            <td style="text-align: right">
                                @foreach (var player in boardGamePlay.Play.Players.OrderByDescending(p => p.Win).ThenByDescending(p => p.Score))
                                {
                                    var scoreDisplay = $"{player.Score:0.}";
                                    if (player.Username != null)
                                    {
                                        <a target="_blank" href="http://www.boardgamegeek.com/collection/user/@player.Username" style="text-decoration: none">
                                            <span class="small@(player.Win ? " bold" : "")">@player.Name</span>
                                        </a>
                                    }
                                    else
                                    {
                                        <span class="small@(player.Win ? " bold" : "")">@player.Name</span>
                                    }
                                    <smaller class="smallest@(player.Win ? " bold" : "")">@scoreDisplay</smaller>
                                    <br />
                                }
                            </td>
                        </tr>
                    </table>
                </td>
                <td>
                    <partial name="_PlayerNumbers" model="boardGamePlay.BoardGame" />
                </td>
            </tr>
        }
    }

</table>
